<!DOCTYPE html>
<html>
<head>
<style>
html {overflow:hidden}
body {position: absolute; margin:0; padding:0;width:100%; height:100%}
canvas {display:block;border:2px solid #ccc; margin:10px auto;}
p {text-align: center; font-size:12px;color:#454545;}
</style>
<script src="http://hongru.github.com/js/JCanvas.js"></script>	
</head>
<body>
<canvas id="canvas" width="600" height="400"></canvas>
<script>
	var canvas=document.getElementById('canvas'),
		ctx=canvas.getContext('2d'),
		zPos=200,
		radius=20,
		num=10,
		vpx = canvas.width/2,
		vpy = canvas.height/2,
		balls=[],
		requestAnimFrame=window.requestAnimationFrame 
        || window.webkitRequestAnimationFrame 
        || window.mozRequestAnimationFrame 
        || window.oRequestAnimationFrame 
        || window.msRequestAnimationFrame 
        || function(callback) {return window.setTimeout(callback, 16); };

	function rotateY(ball, angleY) {
		var cos = Math.cos(angleY),
			sin = Math.sin(angleY),
			x1 = ball.x * cos - ball.z * sin,
			z1 = ball.z * cos + ball.x * sin;
		ball.x =x1;
		ball.z =z1;
	}

	function roteteX(ball,angleX){
		var cos = Math.cos(angleX),
			sin = Math.sin(angleX),
			y1 = ball.y * cos - ball.z * sin,
			z1 = ball.z * cos + ball.y * sin;
		ball.y = y1;
		ball.z = z1;
	}

	function Ball(x,y,z){
		this.x=x;
		this.y=y;
		this.z=z;

		this.r=Math.floor(Math.random()*250);
		this.g=Math.floor(Math.random()*250);
		this.b=Math.floor(Math.random()*250);
	}

	Ball.prototype.paint=function(){
		ctx.save();
		ctx.beginPath();
		ctx.fillStyle='rgba('+this.r+','+this.g+','+this.b+',0.5)';
		// var scale=zPos/(zPos+this.z);
		var scale=2*zPos/(2*zPos-this.z);
		ctx.arc(vpx+this.x,vpy+this.y,radius*scale,0,Math.PI*2,false);//canvas.width / 2 + (this.x - canvas.width / 2) * scale
		ctx.fill();
		ctx.restore();
	};
	for(var i=0;i<num;i++){
		balls.push(new Ball(Math.random()*canvas.width-canvas.width/2,Math.random()*canvas.height-canvas.height/2,Math.random()*zPos*2-zPos));
	}

	function animate(){
		(function(){
			ctx.clearRect(0,0,canvas.width,canvas.height)
			balls.forEach(function(item,i){
				rotateY(item,Math.PI/500);
				roteteX(item,Math.PI/200);
				item.paint();
			});
			requestAnimFrame(arguments.callee);
		}());
	}

	animate();

</script>
</body>
</html>


