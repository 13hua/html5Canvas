<!DOCTYPE html>
<html>
<head>
<style>
html {overflow:hidden}
body {position: absolute; margin:0; padding:0;width:100%; height:100%}
canvas {display:block;border:2px solid #ccc; margin:10px auto;}
p {text-align: center; font-size:12px;color:#454545;}
</style>
<script src="http://hongru.github.com/js/JCanvas.js"></script>	
</head>
<body>
<canvas id="canvas" width="600" height="400"></canvas>
<script>
	var canvas=document.getElementById('canvas'),
		ctx=canvas.getContext('2d'),
		zRadius=200
		num=10,
		zPos=0,
		vpx = canvas.width/2,
		vpy = canvas.height/2,
		balls=[];
    var requestAnimFrame=window.requestAnimationFrame 
        || window.webkitRequestAnimationFrame 
        || window.mozRequestAnimationFrame 
        || window.oRequestAnimationFrame 
        || window.msRequestAnimationFrame 
        || function(callback) {return window.setTimeout(callback, 16); };

	function createBall(){
		for(var i=0;i<num;i++){
			var ball=new Ball();
			balls.push(ball);
			ctx.save();
			ctx.beginPath();
			var scale=zRadius/(zRadius+ball.dz);
			ctx.arc(ball.dx,ball.dy,ball.radius*scale,0,Math.PI*2,false);
			ctx.fillStyle='rgba('+ball.r+','+ball.g+','+ball.b+','+scale+')';
			ctx.fill();
			ctx.restore();
		}
	}

	function bindEvent(){
		document.addEventListener('keydown',function(evt){
			if(evt.keyCode==38){
				zPos+=5
			} else if(evt.keyCode==40){
				zPos-=5;
			}
		});
	}

	function animate(){
		(function(){
			balls.forEach(function(item,i){
				rotateY(item,Math.PI/100);
				ctx.save();
				ctx.beginPath();
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				ctx.arc(Math.floor(item.x),Math.floor(item.y),item.radius,0,Math.PI*2,false);
				ctx.fillStyle='rgba('+item.r+','+item.g+','+item.b+',0.5)';
				ctx.fill();
				ctx.restore();
			});
			requestAnimFrame(arguments.callee);
		}())
	}

	function rotateY(ball, angleY) {
		var cosy = Math.cos(angleY),
			siny = Math.sin(angleY),
			x1 = ball.dx * cosy - ball.dz * siny,
			z1 = ball.dz * cosy + ball.dx * siny;
		ball.dx = x1;
		ball.dz = z1;

		var scale = zRadius / (zRadius + ball.dz);
		ball.x = vpx + ball.dx * scale;
		ball.y = vpy + ball.dy * scale;
		// ball.radius = Math.ceil(ball.radius*scale);
	}
 

	function Ball(){
		this.dx=Math.random()*canvas.width;
		this.dy=Math.random()*canvas.height;
		this.dz=Math.random()*zRadius*2-zRadius;
		this.x=0;
		this.y=0;
		this.z=0;
		this.radius=20,
		this.r=Math.floor(Math.random()*255);
		this.g=Math.floor(Math.random()*255);
		this.b=Math.floor(Math.random()*255);
	}

	function init(){
		createBall();
		animate();
		bindEvent();
	}
	init();
</script>
</body>
</html>


