<!doctype html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<style>
    html,body {
        padding: 0;
        margin: 0;
    }

    canvas {
        background-color:rgba(0,0,0,1);
        -webkit-transition: background-color 1s ease-in-out;
        -o-transition: background-color 1s ease-in-out;
        transition: background-color 1s ease-in-out;
    }
    img{display: none;}
</style>
<title>canvas粒子特效</title>
</head>
<body>
<div>
<img src="cake.png" alt="">
<canvas id='canvas' width="1200" height="800">浏览器不支持canvas</canvas>
</div>
<script>
// 粉红，绿色，天蓝色，白色，紫色
    (function(){
        var RequestAnimFrame=window.requestAnimationFrame 
            || window.webkitRequestAnimationFrame 
            || window.mozRequestAnimationFrame 
            || window.oRequestAnimationFrame 
            || window.msRequestAnimationFrame 
            || function(callback) {return window.setTimeout(callback, 1000/60); },

        CancelRequestAnimFrame=window.cancelRequestAnimationFrame
		    || window.webkitCancelAnimationFrame
		    || window.webkitCancelRequestAnimationFrame
		    || window.mozCancelRequestAnimationFrame
		    || window.oCancelRequestAnimationFrame
		    || window.msCancelRequestAnimationFrame
		    || clearTimeout;

        var CVS=(function(){
            var canvas=document.getElementById('canvas'),
                ctx=canvas.getContext('2d');
                vpx=canvas.width/2,
                vpy=canvas.height/2;

            canvas.width=window.innerWidth;
            canvas.height=window.innerHeight;
            vpx=canvas.width/2;
            vpy=canvas.height/2;
            ctx.translate(this.vpx,this.vpy);//坐标原点重置为中间

            return {
                canvas:canvas,
                ctx:ctx,
                vpx: vpx,
                vpy: vpy,
                clearRect:function(){
                    ctx.clearRect(-vpx, -vpy, canvas.width, canvas.height);
                }
            }
        }());

        /**
         * 动画公式
         * @param    {Number}                 t  current time 当前时间点（当前时间-开始时间）
         * @param    {Number}                 b  beginning value 初始值
         * @param    {Number}                 c  change in value 需要移动的距离（结束点坐标-开始点坐标）
         * @param    {Number}                 d  duration 持续时间（多少时间内完成动画）
         * @return   {Number}                 返回当前时间点的位置
         */
        var tween={
            linear:function(t,b,c,d){ 
                return c*t/d + b; 
            },
            easeIn: function(t,b,c,d){
                return c*(t/=d)*t*t*t*t + b;
            },
            easeOut: function(t,b,c,d){
                return c*((t=t/d-1)*t*t*t*t + 1) + b;
            },
            easeInOut: function(t,b,c,d){
                if ((t/=d/2) < 1) return c/2*t*t*t*t*t + b;
                return c/2*((t-=2)*t*t*t*t + 2) + b;
            }
        };

        var Rotates={
            // 绕x轴旋转
            rotateX:function (ball,angleX){
                var cos = Math.cos(angleX),
                    sin = Math.sin(angleX),
                    y1 = ball.y * cos - ball.z * sin,
                    z1 = ball.z * cos + ball.y * sin,
                    y2 = ball.dy * cos - ball.dz * sin,
                    z2 = ball.dz * cos + ball.dy * sin,
                    y3 = ball.fy * cos - ball.fz * sin,
                    z3 = ball.fz * cos + ball.fy * sin,
                    y4 = ball.sy * cos - ball.sz * sin,
                    z4 = ball.sz * cos + ball.sy * sin;
                ball.y = y1;
                ball.z = z1;
                ball.dy = y2;
                ball.dz = z2;
                ball.fy = y3;
                ball.fz = z3;
                ball.sy = y4;
                ball.sz = z4;
            },
            // 绕y轴旋转
            rotateY:function (ball, angleY) {
                var cos = Math.cos(angleY),
                    sin = Math.sin(angleY),
                    x1 = ball.x * cos - ball.z * sin,
                    z1 = ball.z * cos + ball.x * sin,
                    x2 = ball.dx * cos - ball.dz * sin,
                    z2 = ball.dz * cos + ball.dx * sin,
                    x3 = ball.fx * cos - ball.fz * sin,
                    z3 = ball.fz * cos + ball.fx * sin,
                    x4 = ball.sx * cos - ball.sz * sin,
                    z4 = ball.sz * cos + ball.sx * sin;
                ball.x =x1;
                ball.z =z1;
                ball.dx =x2;
                ball.dz =z2;
                ball.fx =x3;
                ball.fz =z3;
                ball.sx =x4;
                ball.sz =z4;
            },
            // 绕z轴旋转
            rotateZ:function(ball,angleZ){
                var cos = Math.cos(angleZ),
                    sin = Math.sin(angleZ),
                    x1 = ball.x * cos - ball.y * sin,
                    y1 = ball.y * cos + ball.x * sin;
                    x2 = ball.dx * cos - ball.dy * sin,
                    y2 = ball.dy * cos + ball.dx * sin;
                    x3 = ball.fx * cos - ball.fy * sin,
                    y3 = ball.fy * cos + ball.fx * sin;
                    x4 = ball.sx * cos - ball.sy * sin,
                    y4 = ball.sy * cos + ball.sx * sin;
                ball.x = x1;
                ball.y = y1;
                ball.dx = x2;
                ball.dy = y2;
                ball.fx = x3;
                ball.fy = y3;
                ball.sx = x4;
                ball.sy = y4;
            }
        };

        function getRandom(a, b) {
            return Math.floor(Math.random() * (b - a)) + a;
        }

        function Point(zRadius,zPos,x,y,z,radius,rgb,isBg){
            // 点在字体中的坐标
            this.dx=x-CVS.vpx;
            this.dy=y-CVS.vpy;
            this.dz=z;
            // 点第一次随机的坐标
            this.sx=getRandom(-CVS.vpx*4,CVS.vpx*4);
            this.sy=getRandom(-CVS.vpy*4,CVS.vpy*4);
            this.sz=getRandom(zRadius*0,zRadius*8);
            // 点最终飞离的坐标
            this.fx=getRandom(-CVS.vpx*2,CVS.vpx*2);
            this.fy=getRandom(-CVS.vpy*2,CVS.vpy*2);
            this.fz=getRandom(-zRadius*2,zRadius*2);
            // 点当前位置
            this.x=this.sx;
            this.y=this.sy;
            this.z=this.sz;
            this.radius=radius;
            this.rgb=rgb;
            this.zRadius=zRadius;
            this.zPos=zPos;
            this.isBg=isBg||false;
        }
        Point.prototype.paint=function(){
            var scale = Math.abs(this.zRadius/(this.zRadius-this.z+this.zPos));
            CVS.ctx.save();
            CVS.ctx.beginPath();
            CVS.ctx.arc(this.x*scale,this.y*scale, this.radius * scale, 0, 2 * Math.PI);
            CVS.ctx.fillStyle = 'rgba('+this.rgb.r+','+this.rgb.g+','+this.rgb.b+',' + scale*0.8 + ')';
            CVS.ctx.fill();
            CVS.ctx.restore();
        };

        function PointEffect(opt){
            var options={
                zRadius:200,
                zPos:0,
                txts:['粒子特效']
            };
            for(var prop in opt){
                opt[prop]&&(options[prop]=opt[prop]);
            }

            this.zRadius=options.zRadius;//z轴的半径
            this.zPos=options.zPos;//控制距离
            this.txts=options.txts;
            this.angleX=Math.PI/4000;
	        this.angleY=Math.PI/4000;
            this.poionts=[];
            this.bgPoints=[];
        }
        PointEffect.prototype={
            init:function(){
            	var self=this;
            	this.bindEvent();
	            self.animate(0);
            },
            bindEvent:function(){
            	var self=this;
            	document.addEventListener('mousemove', function(event){
					var x = event.clientX - CVS.vpx;
					var y = event.clientY - CVS.vpy;
					self.angleY = x*0.00001;
					self.angleX = y*0.00001;
            	});
            },
            drawText:function(txt){
                CVS.ctx.save()
                CVS.ctx.font = "180px Microsoft YaHei bold";
                // 设置渐变
                var gradient=CVS.ctx.createLinearGradient(-CVS.vpx,0,CVS.vpx,0);
                gradient.addColorStop(0,'#0f0');
                gradient.addColorStop(0.3,'purple');
                gradient.addColorStop(0.5,'pink');
                gradient.addColorStop(0.6,'orange');
                gradient.addColorStop(1,'yellow');

                CVS.ctx.fillStyle=gradient;
                CVS.ctx.textAlign = "center";
                CVS.ctx.textBaseline = "middle";
                CVS.ctx.fillText(txt, 0,0);
                CVS.ctx.restore();
            },
            getTxtData:function(){
                var imgData = CVS.ctx.getImageData(0,0, CVS.canvas.width, CVS.canvas.height);
                CVS.clearRect();
                this.points = [];
                for (var x = 0; x < imgData.width; x += 8) {
                    for (var y = 0; y < imgData.height; y += 8) {
                        var i = (y * imgData.width + x) * 4;
                        if (imgData.data[i+3] >= 128) {
                            this.points.push(new Point(this.zRadius,this.zPos,x, y, 0, 4,{r:imgData.data[i],g:imgData.data[i+1],b:imgData.data[i+2]}));
                        }
                    }
                }
            },
            getBgData:function(){
                this.bgPoints=[];
                for(var i=0;i<100;i++){
                    var point=new Point(this.zRadius,this.zPos,0, 0, 10, 4,{r:getRandom(50,250),g:getRandom(50,250),b:getRandom(50,250)},true);
                    point.x=getRandom(-this.zRadius*2,this.zRadius*2);
                    point.y=getRandom(-this.zRadius*2,this.zRadius*2);
                    point.z=getRandom(-this.zRadius*3,this.zRadius*3);
                    this.bgPoints.push(point);
                }
            },
            animate:function(index){
            	var stage=0,
	            	zoom=0.05,
	            	startTime=new Date(), 
	            	angleZ=index%2?Math.PI/300:-Math.PI/300,
	            	isLoop=false,
	            	self=this;
 
                 this.drawText(this.txts[index]);
                 this.getTxtData(this.txts[index]);
                 this.getBgData();

                (function(){
                    switch(stage){
                        case 0:
                            if(new Date()-startTime>2000){
                            	startTime=new Date();
                            	stage++;
                            	if(index==self.txts.length-1){
                            		isLoop=true;
                            	}
                                break;
                            }
                            self.bgPoints.forEach(function(item,i){
                                Rotates.rotateZ(item,angleZ);
                                item.zPos+=2;//视角后退
                            });
                            break;
                        case 1:
                    	    self.bgPoints.forEach(function(item,i){
	                            Rotates.rotateY(item,self.angleY);
	                            Rotates.rotateX(item,self.angleX);
                            });
                        	if(new Date()-startTime>3000){
                        		if(isLoop){
		                            self.points.forEach(function(item,i){
		                                Rotates.rotateY(item,self.angleY);
		                                Rotates.rotateX(item,self.angleX);
		                                item.x=item.dx;
		                                item.y=item.dy;
		                                item.z=item.dz;
		                            });
		                            break;
                        		}
                        		startTime=new Date();
                        		stage++;
                        		break;
                        	}

                            self.points.forEach(function(item,i){
                                Rotates.rotateY(item,self.angleY);
                                Rotates.rotateX(item,self.angleX);
                                item.x=tween.easeOut(new Date()-startTime,item.sx,item.dx-item.sx,3000);
                                item.y=tween.easeOut(new Date()-startTime,item.sy,item.dy-item.sy,3000);
                                item.z=tween.easeOut(new Date()-startTime,item.sz,item.dz-item.sz,3000);
                            });
                            break;
                        case 2:
                            if(new Date()-startTime>3000){
                            	CVS.clearRect();
                            	self.animate(++index%self.txts.length);
                            	return false;
                            }
                            self.bgPoints.forEach(function(item,i){
                                Rotates.rotateY(item,self.angleY);
                                Rotates.rotateX(item,self.angleX);
                            });
                            self.points.forEach(function(item,i){
                                Rotates.rotateY(item,self.angleY);
                                Rotates.rotateX(item,self.angleX);
                                item.x=tween.easeInOut(new Date()-startTime,item.dx,item.fx-item.dx,2500);
                                item.y=tween.easeInOut(new Date()-startTime,item.dy,item.fy-item.dy,2500);
                                item.z=tween.easeInOut(new Date()-startTime,item.dz,item.fz-item.dz,2500);
                            });
                            break;
                        default:break;
                    }
                    CVS.clearRect();
                    self.bgPoints.forEach(function(item,i){
                        item.paint();
                    });
                    if(stage>0){
                        self.points.sort(function(a,b){
                            return b.z-a.z;
                        });
                        self.points.forEach(function(item,i){
                            item.paint(); 
                        });
                    }
                    RequestAnimFrame(arguments.callee);
                }());
            },
        };

        var rects=[];
        function Rect(zRadius,zPos,x,y,z,radius,rgb) {
            // 点在字体中的坐标
            this.dx=x-CVS.vpx;
            this.dy=y-CVS.vpy;
            this.dz=z;
            // 点第一次随机的坐标
            this.sx=getRandom(-CVS.vpx,CVS.vpx);
            this.sy=getRandom(-CVS.vpy,CVS.vpy);
            this.sz=getRandom(-zRadius,zRadius);
            // 点最终飞离的坐标
            this.fx=getRandom(-CVS.vpx,CVS.vpx);
            this.fy=getRandom(-CVS.vpy,CVS.vpy);
            this.fz=getRandom(-zRadius,zRadius);
            // 点当前位置
            this.x=this.sx;
            this.y=this.sy;
            this.z=this.sz;
            this.radius=radius;
            this.rgb=rgb;
            this.zRadius=zRadius;
            this.zPos=zPos;
        };
        Rect.prototype.paint=function(){
            var scale = Math.abs(this.zRadius/(2*this.zRadius+this.z+this.zPos));
            CVS.ctx.save();
            CVS.ctx.beginPath();
            CVS.ctx.fillStyle = 'rgba('+this.rgb.r+','+this.rgb.g+','+this.rgb.b+',' + scale*0.8 + ')';
            CVS.ctx.fillRect(this.x*scale,this.y*scale, this.radius * scale*2,this.radius * scale*2);
            CVS.ctx.restore();
        };
        function getImgData(){
            var imgData = CVS.ctx.getImageData(0,0, CVS.canvas.width, CVS.canvas.height);
            CVS.clearRect();
            for (var x = 0; x < imgData.width; x += 3) {
                for (var y = 0; y < imgData.height; y += 3) {
                    var i = (y * imgData.width + x) * 4;
                    if (imgData.data[i+3] >= 128) {
                        rects.push(new Rect(200,0,x-3, y-3, 0, 3,{r:imgData.data[i],g:imgData.data[i+1],b:imgData.data[i+2]}));
                    }
                }
            }
        }
        var img=new Image(); img.src='cake.png';
        var img2=new Image(); img2.src='cake2.png';
        var img3=new Image(); img3.src='data:image/png;base64,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';
        img3.onload=function(){
            CVS.ctx.drawImage(img3, - img3.width / 2, - img3.height / 2);
            getImgData();
            var stage=0,
                startTime=new Date(),
                sulv=0.1;

            (function(){
                CVS.ctx.save();
                CVS.ctx.globalCompositeOperation = 'destination-out';
                CVS.ctx.globalAlpha = 0.1;
                CVS.ctx.fillRect(-CVS.vpx, -CVS.vpy, canvas.width, canvas.height);
                CVS.ctx.restore();
                rects.forEach(function(item,i){
                    if(stage==0){
                        if(new Date()-startTime>900){
                            stage++;
                            CVS.clearRect();
                            startTime=new Date();
                            return false;
                        }
                        item.x=tween.linear(new Date()-startTime,item.sx,item.dx-item.sx,900);
                        item.y=tween.linear(new Date()-startTime,item.sy,item.dy-item.sy,900);
                        item.z=tween.linear(new Date()-startTime,item.sz,item.dz-item.sz,900);
                    } else {
                        if(new Date()-startTime>2500){
                            return false;
                        }
                        item.x=tween.easeInOut(new Date()-startTime,item.dx,item.fx-item.dx,2500);
                        item.y=tween.easeInOut(new Date()-startTime,item.dy,item.fy-item.dy,2500);
                        item.z=tween.easeInOut(new Date()-startTime,item.dz,item.fz-item.dz,2500);
                    }
                });

                rects.forEach(function(item,i){
                    item.paint();
                });
                RequestAnimFrame(arguments.callee);
            }())
        }

        var effect=new PointEffect({
        	zPos:0,
        	txts:['粒子特效','canvas','jeff.zhong','hi,there']
        });
        // effect.init();
    }());
</script>
</body>
</html>